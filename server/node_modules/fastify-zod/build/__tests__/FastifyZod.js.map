{"version":3,"file":"FastifyZod.js","names":["test","jsonSchemas","buildJsonSchemas","models","f","createTestServer","swaggerOptions","transformSpec","options","mergeRefs","$ref","expect","inject","method","url","then","res","json","resolves","toEqual","todoItems","payload","error","message","statusCode","id","label","state","dueDateMs","Date","getTime"],"sources":["../../src/__tests__/FastifyZod.ts"],"sourcesContent":["import { buildJsonSchemas } from \"../JsonSchema\";\n\nimport { models } from \"./models.fixtures\";\nimport { createTestServer } from \"./server.fixtures\";\n\ntest(`FastifyZod`, async () => {\n  const jsonSchemas = buildJsonSchemas(models, {});\n  const f = createTestServer(\n    {},\n    {\n      jsonSchemas,\n      swaggerOptions: {\n        transformSpec: {\n          options: {\n            mergeRefs: [jsonSchemas.$ref(`TodoState`)],\n          },\n        },\n      },\n    },\n  );\n\n  await expect(\n    f\n      .inject({\n        method: `get`,\n        url: `/item`,\n      })\n      .then((res) => res.json()),\n  ).resolves.toEqual({ todoItems: [] });\n\n  await expect(\n    f\n      .inject({\n        method: `post`,\n        url: `/item`,\n        payload: {},\n      })\n      .then((res) => res.json()),\n  ).resolves.toEqual({\n    error: `Bad Request`,\n    message: `body should have required property 'id'`,\n    statusCode: 400,\n  });\n\n  await expect(\n    f\n      .inject({\n        method: `post`,\n        url: `/item`,\n        payload: {\n          id: 1337,\n        },\n      })\n      .then((res) => res.json()),\n  ).resolves.toEqual({\n    error: `Bad Request`,\n    message: `body.id should match format \"uuid\"`,\n    statusCode: 400,\n  });\n\n  await expect(\n    f\n      .inject({\n        method: `post`,\n        url: `/item`,\n        payload: {\n          id: `e7f7082a-4f16-430d-8c3b-db6b8d4d3e73`,\n          label: `todo`,\n          state: `todo`,\n          dueDateMs: new Date(1337).getTime(),\n        },\n      })\n      .then((res) => res.json()),\n  ).resolves.toEqual({\n    todoItems: [\n      {\n        id: `e7f7082a-4f16-430d-8c3b-db6b8d4d3e73`,\n        label: `todo`,\n        state: `todo`,\n        dueDateMs: new Date(1337).getTime(),\n      },\n    ],\n  });\n\n  await expect(\n    f\n      .inject({\n        method: `put`,\n        url: `/item/1337`,\n      })\n      .then((res) => res.json()),\n  ).resolves.toEqual({\n    error: `Bad Request`,\n    message: `params.id should match format \"uuid\"`,\n    statusCode: 400,\n  });\n});\n"],"mappings":";;AAAA;;AAEA;;AACA;;AAEAA,IAAI,CAAE,YAAF,EAAe,YAAY;EAC7B,MAAMC,WAAW,GAAG,IAAAC,4BAAA,EAAiBC,cAAjB,EAAyB,EAAzB,CAApB;EACA,MAAMC,CAAC,GAAG,IAAAC,wBAAA,EACR,EADQ,EAER;IACEJ,WADF;IAEEK,cAAc,EAAE;MACdC,aAAa,EAAE;QACbC,OAAO,EAAE;UACPC,SAAS,EAAE,CAACR,WAAW,CAACS,IAAZ,CAAkB,WAAlB,CAAD;QADJ;MADI;IADD;EAFlB,CAFQ,CAAV;EAcA,MAAMC,MAAM,CACVP,CAAC,CACEQ,MADH,CACU;IACNC,MAAM,EAAG,KADH;IAENC,GAAG,EAAG;EAFA,CADV,EAKGC,IALH,CAKSC,GAAD,IAASA,GAAG,CAACC,IAAJ,EALjB,CADU,CAAN,CAOJC,QAPI,CAOKC,OAPL,CAOa;IAAEC,SAAS,EAAE;EAAb,CAPb,CAAN;EASA,MAAMT,MAAM,CACVP,CAAC,CACEQ,MADH,CACU;IACNC,MAAM,EAAG,MADH;IAENC,GAAG,EAAG,OAFA;IAGNO,OAAO,EAAE;EAHH,CADV,EAMGN,IANH,CAMSC,GAAD,IAASA,GAAG,CAACC,IAAJ,EANjB,CADU,CAAN,CAQJC,QARI,CAQKC,OARL,CAQa;IACjBG,KAAK,EAAG,aADS;IAEjBC,OAAO,EAAG,yCAFO;IAGjBC,UAAU,EAAE;EAHK,CARb,CAAN;EAcA,MAAMb,MAAM,CACVP,CAAC,CACEQ,MADH,CACU;IACNC,MAAM,EAAG,MADH;IAENC,GAAG,EAAG,OAFA;IAGNO,OAAO,EAAE;MACPI,EAAE,EAAE;IADG;EAHH,CADV,EAQGV,IARH,CAQSC,GAAD,IAASA,GAAG,CAACC,IAAJ,EARjB,CADU,CAAN,CAUJC,QAVI,CAUKC,OAVL,CAUa;IACjBG,KAAK,EAAG,aADS;IAEjBC,OAAO,EAAG,oCAFO;IAGjBC,UAAU,EAAE;EAHK,CAVb,CAAN;EAgBA,MAAMb,MAAM,CACVP,CAAC,CACEQ,MADH,CACU;IACNC,MAAM,EAAG,MADH;IAENC,GAAG,EAAG,OAFA;IAGNO,OAAO,EAAE;MACPI,EAAE,EAAG,sCADE;MAEPC,KAAK,EAAG,MAFD;MAGPC,KAAK,EAAG,MAHD;MAIPC,SAAS,EAAE,IAAIC,IAAJ,CAAS,IAAT,EAAeC,OAAf;IAJJ;EAHH,CADV,EAWGf,IAXH,CAWSC,GAAD,IAASA,GAAG,CAACC,IAAJ,EAXjB,CADU,CAAN,CAaJC,QAbI,CAaKC,OAbL,CAaa;IACjBC,SAAS,EAAE,CACT;MACEK,EAAE,EAAG,sCADP;MAEEC,KAAK,EAAG,MAFV;MAGEC,KAAK,EAAG,MAHV;MAIEC,SAAS,EAAE,IAAIC,IAAJ,CAAS,IAAT,EAAeC,OAAf;IAJb,CADS;EADM,CAbb,CAAN;EAwBA,MAAMnB,MAAM,CACVP,CAAC,CACEQ,MADH,CACU;IACNC,MAAM,EAAG,KADH;IAENC,GAAG,EAAG;EAFA,CADV,EAKGC,IALH,CAKSC,GAAD,IAASA,GAAG,CAACC,IAAJ,EALjB,CADU,CAAN,CAOJC,QAPI,CAOKC,OAPL,CAOa;IACjBG,KAAK,EAAG,aADS;IAEjBC,OAAO,EAAG,sCAFO;IAGjBC,UAAU,EAAE;EAHK,CAPb,CAAN;AAYD,CA3FG,CAAJ"}