{"version":3,"file":"server.fixtures.js","names":["swaggerOptions","routePrefix","swagger","info","title","description","version","staticCSP","exposeRoute","openApiOptions","openapi","createTestServer","fastifyOptions","registerOptions","f","register","fastify","state","todoItems","zod","get","operationId","reply","key","done","filter","item","inProgress","todo","post","body","nextItem","some","prevItem","id","BadRequest","put","params","NotFound","map"],"sources":["../../src/__tests__/server.fixtures.ts"],"sourcesContent":["import fastify, { FastifyInstance, FastifyServerOptions } from \"fastify\";\nimport { BadRequest, NotFound } from \"http-errors\";\n\nimport { register } from \"..\";\nimport { RegisterOptions } from \"../FastifyZod\";\n\nimport { models, TodoItems } from \"./models.fixtures\";\n\nexport const swaggerOptions: RegisterOptions<typeof models>[`swaggerOptions`] =\n  {\n    routePrefix: `/swagger`,\n    swagger: {\n      info: {\n        title: `Fastify Zod Test Server`,\n        description: `Test Server for Fastify Zod`,\n        version: `0.0.0`,\n      },\n    },\n    staticCSP: true,\n    exposeRoute: true,\n  };\n\nexport const openApiOptions: RegisterOptions<typeof models>[`swaggerOptions`] =\n  {\n    openapi: {\n      info: {\n        title: `Fastify Zod Test Server`,\n        description: `Test Server for Fastify Zod`,\n        version: `0.0.0`,\n      },\n    },\n    staticCSP: true,\n    exposeRoute: true,\n  };\n\nexport const createTestServer = (\n  fastifyOptions: FastifyServerOptions,\n  registerOptions: RegisterOptions<typeof models>,\n): FastifyInstance => {\n  const f = register(fastify(fastifyOptions), registerOptions);\n\n  const state: TodoItems = {\n    todoItems: [],\n  };\n\n  f.zod.get(\n    `/item`,\n    {\n      operationId: `getTodoItems`,\n      reply: {\n        description: `The list of Todo Items`,\n        key: `TodoItems`,\n      },\n    },\n    async () => state,\n  );\n\n  f.zod.get(\n    `/item/grouped-by-status`,\n    {\n      operationId: `getTodoItemsGroupedByStatus`,\n      reply: `TodoItemsGroupedByStatus`,\n    },\n    async () => ({\n      done: state.todoItems.filter((item) => item.state === `done`),\n      inProgress: state.todoItems.filter(\n        (item) => item.state === `in progress`,\n      ),\n      todo: state.todoItems.filter((item) => item.state === `todo`),\n    }),\n  );\n\n  f.zod.post(\n    `/item`,\n    {\n      operationId: `postTodoItem`,\n      body: `TodoItem`,\n      reply: `TodoItems`,\n    },\n    async ({ body: nextItem }) => {\n      if (state.todoItems.some((prevItem) => prevItem.id === nextItem.id)) {\n        throw new BadRequest(`item already exists`);\n      }\n      state.todoItems = [...state.todoItems, nextItem];\n      return state;\n    },\n  );\n\n  f.zod.put(\n    `/item/:id`,\n    {\n      operationId: `putTodoItem`,\n      body: `TodoItem`,\n      params: `TodoItemId`,\n      reply: `TodoItem`,\n    },\n    async ({ params: { id }, body: nextItem }) => {\n      if (!state.todoItems.some((prevItem) => prevItem.id === id)) {\n        throw new NotFound(`no such item`);\n      }\n      state.todoItems = state.todoItems.map((prevItem) =>\n        prevItem.id === id ? nextItem : prevItem,\n      );\n      return nextItem;\n    },\n  );\n\n  f.zod.get(\n    `/42`,\n    { operationId: `getFortyTwo`, reply: `FortyTwo` },\n    async () => 42,\n  );\n\n  return f;\n};\n"],"mappings":"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"}