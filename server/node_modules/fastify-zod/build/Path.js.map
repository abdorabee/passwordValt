{"version":3,"file":"Path.js","names":["stringifyPath","path","join","equalPath","a","b","length","k","getParentPath","Error","slice","getChildPath","childPath","getPathLastSegment","getChildSafe","current","segment","Array","isArray","index","parseInt","Number","isInteger","undefined","isRecord","Object","keys","includes","getAtPathSafe","obj","childFound","child","getAtPath","found","value","setAtPath","parentFound","parent","key","push","deleteAtPath","pop","matchPathPrefix","prefixPath","replacePathPrefix","prevPrefixPath","nextPrefixPath"],"sources":["../src/Path.ts"],"sourcesContent":["import { isRecord } from \"./util\";\n\nexport const stringifyPath = (path: string[]): string => path.join(`/`);\n\nexport const equalPath = (a: string[], b: string[]): boolean => {\n  if (a.length !== b.length) {\n    return false;\n  }\n  for (let k = 0; k < a.length; k++) {\n    if (a[k] !== b[k]) {\n      return false;\n    }\n  }\n  return true;\n};\n\nconst getParentPath = <T extends string>(path: T[]): T[] => {\n  if (path.length === 0) {\n    throw new Error(`path='${stringifyPath(path)}' has no parent`);\n  }\n  return path.slice(0, -1);\n};\n\nexport const getChildPath = <T extends string>(\n  path: T[],\n  ...childPath: T[]\n): T[] => [...path, ...childPath];\n\nconst getPathLastSegment = <T extends string>(path: T[]): T => {\n  if (path.length === 0) {\n    throw new Error(`path='${stringifyPath}' has no parent`);\n  }\n  return path[path.length - 1];\n};\n\nconst getChildSafe = (\n  current: unknown,\n  segment: string,\n): [childFound: boolean, value: unknown] => {\n  if (Array.isArray(current)) {\n    const index = parseInt(segment);\n    if (!Number.isInteger(index)) {\n      throw new Error(\n        `current is an array but segment='${segment}' is not an integer`,\n      );\n    }\n    if (index < 0) {\n      throw new Error(`current is an array but index='${index}' is negative`);\n    }\n    return [typeof current[index] !== undefined, current[index]];\n  }\n  if (isRecord(current)) {\n    return [Object.keys(current).includes(segment), current[segment]];\n  }\n  return [false, undefined];\n};\n\nexport const getAtPathSafe = (\n  obj: unknown,\n  path: string[],\n): [valueFound: boolean, value: unknown] => {\n  let current = obj;\n\n  for (let k = 0; k < path.length; k++) {\n    const [childFound, child] = getChildSafe(current, path[k]);\n    if (!childFound) {\n      if (k !== path.length - 1) {\n        throw new Error(\n          `parent(path='${stringifyPath(path)}') has no child at segment='${\n            path[k]\n          }'`,\n        );\n      }\n      return [false, undefined];\n    }\n    current = child;\n  }\n  return [true, current];\n};\n\nexport const getAtPath = (obj: unknown, path: string[]): unknown => {\n  const [found, value] = getAtPathSafe(obj, path);\n  if (!found) {\n    throw new Error(`value(path='${stringifyPath(path)}') not found`);\n  }\n  return value;\n};\n\nexport const setAtPath = (\n  obj: unknown,\n  path: string[],\n  value: unknown,\n): void => {\n  const [parentFound, parent] = getAtPathSafe(obj, getParentPath(path));\n  if (!parentFound) {\n    throw new Error(`parent(path='${stringifyPath(path)}') not found`);\n  }\n  const key = getPathLastSegment(path);\n\n  if (Array.isArray(parent)) {\n    const index = parseInt(key);\n    if (!Number.isInteger(index)) {\n      throw new Error(\n        `key(path='${stringifyPath(path)}', key='${key}') is not an integer`,\n      );\n    }\n    if (index < 0) {\n      throw new Error(\n        `index(path='${stringifyPath(path)}', index='${index}') is negative`,\n      );\n    }\n    if (index > parent.length) {\n      throw new Error(\n        `index(path='${stringifyPath(\n          path,\n        )}', index='${index}') is out of bounds`,\n      );\n    }\n    if (index === parent.length) {\n      parent.push(value);\n    } else {\n      parent[index] = value;\n    }\n  } else if (isRecord(parent)) {\n    parent[key] = value;\n  } else {\n    throw new Error(`parent(path='${path}') is not an Array or a Record`);\n  }\n};\n\nexport const deleteAtPath = (obj: unknown, path: string[]): void => {\n  const [parentFound, parent] = getAtPathSafe(obj, getParentPath(path));\n  if (!parentFound) {\n    throw new Error(`parent(path='${stringifyPath(path)}') not found`);\n  }\n  const key = getPathLastSegment(path);\n\n  if (Array.isArray(parent)) {\n    const index = parseInt(key);\n    if (!Number.isInteger(index)) {\n      throw new Error(\n        `key(path='${stringifyPath(path)}', key='${key}') is not an integer`,\n      );\n    }\n    if (index !== parent.length) {\n      throw new Error(\n        `index(path='${stringifyPath(\n          path,\n        )}', index='${index}') is invalid: only last item of parent array can be deleted`,\n      );\n    }\n    parent.pop();\n  } else if (isRecord(parent)) {\n    if (!Object.keys(parent).includes(key)) {\n      throw new Error(\n        `key(path='${stringifyPath(path)}', key='${key}') not found in parent`,\n      );\n    }\n    delete parent[key];\n  } else {\n    throw new Error(\n      `parent(path='${stringifyPath(path)}') is not an Array or a Record`,\n    );\n  }\n};\n\nexport const matchPathPrefix = (\n  prefixPath: readonly string[],\n  path: string[],\n): boolean => {\n  if (path.length < prefixPath.length) {\n    return false;\n  }\n  for (let k = 0; k < prefixPath.length; k++) {\n    if (path[k] !== prefixPath[k]) {\n      return false;\n    }\n  }\n  return true;\n};\n\nexport const replacePathPrefix = <T extends string>(\n  prevPrefixPath: T[],\n  nextPrefixPath: T[],\n  path: T[],\n): T[] => {\n  if (!matchPathPrefix(prevPrefixPath, path)) {\n    throw new Error(\n      `path='${stringifyPath(\n        path,\n      )}' doesn't match prevPrefixPath='${stringifyPath(prevPrefixPath)}'`,\n    );\n  }\n  return [...nextPrefixPath, ...path.slice(prevPrefixPath.length)];\n};\n"],"mappings":"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"}