{"version":3,"file":"JsonSchema.js","names":["buildJsonSchema","Type","schemaKey","buildJsonSchemas","$id","schemas","models","opts","zodSchema","z","object","zodJsonSchema","zodToJsonSchema","target","basePath","jsonSchema","$ref","key","description"],"sources":["../src/JsonSchema.ts"],"sourcesContent":["import { z, ZodType } from \"zod\";\nimport zodToJsonSchema from \"zod-to-json-schema\";\n\nimport { Models, SchemaKeyOrDescription } from \"./Models\";\nexport type BuildJsonSchemasOptions = {\n  readonly $id?: string;\n  readonly target?: `jsonSchema7` | `openApi3`;\n};\n\ntype $Ref<M extends Models> = (key: SchemaKeyOrDescription<M>) => {\n  readonly $ref: string;\n  readonly description?: string;\n};\n\nexport type JsonSchema = {\n  readonly $id: string;\n};\n\nexport type BuildJsonSchemasResult<M extends Models> = {\n  readonly schemas: JsonSchema[];\n  readonly $ref: $Ref<M>;\n};\n\n/**\n * @deprecated\n */\nexport const buildJsonSchema = <T>(\n  Type: ZodType<T>,\n  schemaKey: string,\n): JsonSchema =>\n  buildJsonSchemas({ [schemaKey]: Type }, { $id: schemaKey }).schemas[0];\n\nexport const buildJsonSchemas = <M extends Models>(\n  models: M,\n  opts: BuildJsonSchemasOptions = {},\n): BuildJsonSchemasResult<M> => {\n  const zodSchema = z.object(models);\n\n  const $id = opts.$id ?? `Schema`;\n\n  const zodJsonSchema = zodToJsonSchema(zodSchema, {\n    target: opts.target,\n    basePath: [`${$id}#`],\n  });\n\n  const jsonSchema: JsonSchema = {\n    $id,\n    ...zodJsonSchema,\n  };\n\n  const $ref: $Ref<M> = (key) => {\n    const $ref = `${$id}#/properties/${\n      typeof key === `string` ? key : key.key\n    }`;\n    return typeof key === `string`\n      ? {\n          $ref,\n        }\n      : {\n          $ref,\n          description: key.description,\n        };\n  };\n\n  return {\n    schemas: [jsonSchema],\n    $ref,\n  };\n};\n"],"mappings":";;;;;;;AAAA;;AACA;;;;AAsBA;AACA;AACA;AACO,MAAMA,eAAe,GAAG,CAC7BC,IAD6B,EAE7BC,SAF6B,KAI7BC,gBAAgB,CAAC;EAAE,CAACD,SAAD,GAAaD;AAAf,CAAD,EAAwB;EAAEG,GAAG,EAAEF;AAAP,CAAxB,CAAhB,CAA4DG,OAA5D,CAAoE,CAApE,CAJK;;;;AAMA,MAAMF,gBAAgB,GAAG,CAC9BG,MAD8B,EAE9BC,IAA6B,GAAG,EAFF,KAGA;EAC9B,MAAMC,SAAS,GAAGC,MAAA,CAAEC,MAAF,CAASJ,MAAT,CAAlB;;EAEA,MAAMF,GAAG,GAAGG,IAAI,CAACH,GAAL,IAAa,QAAzB;EAEA,MAAMO,aAAa,GAAG,IAAAC,wBAAA,EAAgBJ,SAAhB,EAA2B;IAC/CK,MAAM,EAAEN,IAAI,CAACM,MADkC;IAE/CC,QAAQ,EAAE,CAAE,GAAEV,GAAI,GAAR;EAFqC,CAA3B,CAAtB;EAKA,MAAMW,UAAsB,GAAG;IAC7BX,GAD6B;IAE7B,GAAGO;EAF0B,CAA/B;;EAKA,MAAMK,IAAa,GAAIC,GAAD,IAAS;IAC7B,MAAMD,IAAI,GAAI,GAAEZ,GAAI,gBAClB,OAAOa,GAAP,KAAgB,QAAhB,GAA0BA,GAA1B,GAAgCA,GAAG,CAACA,GACrC,EAFD;IAGA,OAAO,OAAOA,GAAP,KAAgB,QAAhB,GACH;MACED;IADF,CADG,GAIH;MACEA,IADF;MAEEE,WAAW,EAAED,GAAG,CAACC;IAFnB,CAJJ;EAQD,CAZD;;EAcA,OAAO;IACLb,OAAO,EAAE,CAACU,UAAD,CADJ;IAELC;EAFK,CAAP;AAID,CApCM"}